
<!DOCTYPE html>
<html>
<head>
    <link href="/images/favicon.ico" rel="icon" type="/image/x-icon" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/docs/github.css">
</head>
<div class = "spacing-div">
<article class="markdown-body">
<h1><a id="user-content-llm知识库文档" class="anchor" aria-hidden="true" href="#llm知识库文档"><span aria-hidden="true" class="octicon octicon-link"></span></a>llm知识库文档</h1>
<p>项目根目录:</p>
<p><code>/root/hw/Langchain-Chatchat</code></p>
<p>运行环境(无需手动切换，部署命令中已切换):</p>
<div class="highlight highlight-source-shell"><pre>conda activate langchain
conda activate hw</pre></div>
<h2><a id="user-content-部署" class="anchor" aria-hidden="true" href="#部署"><span aria-hidden="true" class="octicon octicon-link"></span></a>部署</h2>
<p>部署命令(复制自<code>deploy.sh</code>, 但请不要直接运行<code>./deploy.sh</code>, 如果有哪个接口停止运行了，请单独重启便好):</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-c"><span class="pl-c">#</span> 启动</span>
<span class="pl-c"><span class="pl-c">#</span> 语言模型后端</span>
conda activate langchain <span class="pl-k">&amp;&amp;</span> nohup python server/llm_api.py <span class="pl-k">&gt;</span> llm-nohup.log <span class="pl-k">&amp;</span>
<span class="pl-c"><span class="pl-c">#</span> langchain接口</span>
conda activate langchain <span class="pl-k">&amp;&amp;</span> nohup python server/api.py <span class="pl-k">&gt;</span> server_api-nohup.log <span class="pl-k">&amp;</span>
<span class="pl-c"><span class="pl-c">#</span> 方便对接java后端的wrapper接口(将java接口转换为langchain接口)</span>
conda activate hw <span class="pl-k">&amp;&amp;</span> nohup python api_wrapper.py <span class="pl-k">&gt;</span> api_wrapper-nohup.log <span class="pl-k">&amp;</span>

<span class="pl-c"><span class="pl-c">#</span> webui</span>
conda activate langchain <span class="pl-k">&amp;&amp;</span> nohup streamlit run webui.py <span class="pl-k">&amp;</span>

<span class="pl-c"><span class="pl-c">#</span> 多worker(多进程) wrapper(可选用)</span>
conda activate hw <span class="pl-k">&amp;&amp;</span> nohup uvicorn api_wrapper:app --workers 3 --host 61.142.208.114 --port 7860 <span class="pl-k">&gt;</span> api_wrapper-nohup.log <span class="pl-k">&amp;</span>

<span class="pl-c"><span class="pl-c">#</span> 如果使用了多worker的wrapper，关闭接口时请使用以下的方法:</span>

<span class="pl-c"><span class="pl-c">#</span> 由于多进程uvicorn的模式是单父进程多子进程，所以不能直接使用 kill -9 杀掉父进程id. 这里提供一个自建命令killu来一键杀掉子进程和父进程</span>
killu <span class="pl-k">&lt;</span>PID<span class="pl-k">&gt;</span>

<span class="pl-c"><span class="pl-c">#</span> 若killu没有用, 如何杀掉多进程的uvicorn后端: </span>
<span class="pl-c"><span class="pl-c">#</span> 先删所有子进程:</span>
<span class="pl-c"><span class="pl-c">#</span> api -&gt; 查找父进程</span>
<span class="pl-c1">kill</span> <span class="pl-s"><span class="pl-pds">$(</span>pgrep -P <span class="pl-smi">$uvicorn_father_pid</span><span class="pl-pds">)</span></span>
<span class="pl-c"><span class="pl-c">#</span> 再删父进程:</span>
<span class="pl-c1">kill</span> -9 <span class="pl-smi">$uvicorn_pid</span> <span class="pl-c"><span class="pl-c">#</span> 再删父进程</span>

<span class="pl-c"><span class="pl-c">#</span> 一不小心删了父进程, 走投无路:</span>
pkill -9 -f <span class="pl-s"><span class="pl-pds">"</span>.*/root/anaconda3/envs/hw/bin/python3.11 -c from multiprocessing.spawn import spawn_main; spawn_.*<span class="pl-pds">"</span></span></pre></div>
<h2><a id="user-content-llm知识库逻辑" class="anchor" aria-hidden="true" href="#llm知识库逻辑"><span aria-hidden="true" class="octicon octicon-link"></span></a>llm知识库逻辑</h2>
<p>获得用户问题query, 对本地知识库进行检索，若未检索到数据，返回300错误码，若检索到数据，将匹配数据输入chatglm2b语言模型进行润色和处理，返回基于知识库的回答和200错误码</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_14-19-57.png"><img src="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_14-19-57.png" alt="" style="max-width: 100%;"></a></p>
<h2><a id="user-content-代码结构" class="anchor" aria-hidden="true" href="#代码结构"><span aria-hidden="true" class="octicon octicon-link"></span></a>代码结构</h2>
<blockquote>
<p>由于开源项目代码量和文件量较大，这里仅列出重要的文件</p>
</blockquote>
<blockquote>
<p>kill -9 &lt;PID&gt; 中的PID几乎都可以通过 <code>api</code> 命令得到(除了webui.py。它可以使用<code>ps aux | grep webui</code>来找到)</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">文件名</th>
<th align="left">作用</th>
<th align="left">启动命令</th>
<th align="left">关闭命令</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">server/llm_api.py</td>
<td align="left">chatglm2语言模型的生成接口</td>
<td align="left">conda activate langchain &amp;&amp; nohup python server/llm_api.py &gt; llm-nohup.log &amp;</td>
<td align="left">
<code>kill -9 &lt;PID&gt;</code> (3个进程，需要执行3次)</td>
</tr>
<tr>
<td align="center">server/api.py</td>
<td align="left">知识库检索、调用语言模型的总接口</td>
<td align="left">conda activate langchain &amp;&amp; nohup python server/api.py &gt; server_api-nohup.log &amp;</td>
<td align="left"><code>kill -9 &lt;PID&gt;</code></td>
</tr>
<tr>
<td align="center">api_wrapper.py</td>
<td align="left">方便对接java后端的wrapper接口</td>
<td align="left">conda activate hw &amp;&amp; nohup uvicorn api_wrapper:app --workers 3 --host 61.142.208.114 --port 7860 &gt; api_wrapper-nohup.log &amp;</td>
<td align="left">
<code>killu &lt;PID&gt;</code> 若有疑问，请参考上文<strong>部署</strong>中的关闭多worker(多进程)的命令</td>
</tr>
<tr>
<td align="center"><strong>server/chat/knowledge_base_chat.py</strong></td>
<td align="left">知识库检索核心代码, 对知识库检索非常重要。如果想要更改知识库检索的逻辑，改动这个文件</td>
<td align="left">无，仅为调用模块</td>
<td align="left">无，仅为调用模块</td>
</tr>
<tr>
<td align="center">configs/model_config.py</td>
<td align="left">模型配置文件，包括模型路径和匹配相关度阈值</td>
<td align="left">无，仅为调用模块</td>
<td align="left">无，仅为调用模块</td>
</tr>
<tr>
<td align="center">webui.py</td>
<td align="left">图形界面，用于导入数据和简单的部署测试</td>
<td align="left">conda activate langchain &amp;&amp; nohup streamlit run webui.py &amp;</td>
<td align="left">kill -9 &lt;PID&gt;</td>
</tr>
</tbody>
</table>
<h2><a id="user-content-图形界面" class="anchor" aria-hidden="true" href="#图形界面"><span aria-hidden="true" class="octicon octicon-link"></span></a>图形界面</h2>
<p>图形界面地址: <code>http://61.142.208.114:8501/</code></p>
<h4><a id="user-content-1-如何导入文件" class="anchor" aria-hidden="true" href="#1-如何导入文件"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. 如何导入文件</h4>
<p><strong>导入文件小贴士</strong>: 频繁删除向量索引会导致知识库崩溃, 所以，请在处理向量索引的时候，<strong>只添加不删除</strong>!  如果要导入新的数据，请自己新建一个测试知识库，数据向量化，测试数据合格后，再导入到部署知识库<code>2023-8-21</code></p>
<p>将文件(推荐.txt, .csv)放入<code>/root/hw/Langchain-Chatchat/knowledge_base/&lt;你的知识库名称&gt;/content</code></p>
<p>进入webui, 地址: <code>http://61.142.208.114:8501/</code></p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/j1.png"><img src="/images/j1.png" alt="" style="max-width: 100%;"></a></p>
<p>点击链接，进入UI界面。选择知识库管理，切换到相应知识库(现在部署的知识库是: 2023-8-21, 如果要导入测试数据，请新建一个测试知识库)，下面即为已导入的文件。</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/j2.png"><img src="/images/j2.png" alt="" style="max-width: 100%;"></a></p>
<p>P.S. 也可以使用webui来添加txt, csv文件, 更加便捷。</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/j6.png"><img src="/images/j6.png" alt="" style="max-width: 100%;"></a></p>
<p>刚刚添加的文件，选择添加至向量库。等待右上角小人停止跑动，向量库从x变成✓, 添加数据成功。</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/j3.png"><img src="/images/j3.png" alt="" style="max-width: 100%;"></a></p>
<p>使用图形界面测试数据是否成功添加 (如果知识库未搜索到数据，会显示[知识库无匹配])</p>
<p>选择 对话 -&gt; 知识库问答 -&gt; &lt;想要测试的知识库&gt;</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-49-44.png"><img src="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-49-44.png" alt="" style="max-width: 100%;"></a></p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-51-59.png"><img src="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-51-59.png" alt="" style="max-width: 100%;"></a></p>
<p>也可以使用使用dtest 测试数据是否成功添加(如果知识库未搜索到数据，会显示[知识库无匹配])</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/j4.png"><img src="/images/j4.png" alt="" style="max-width: 100%;"></a></p>
<p>反之，有记录</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/j5.png"><img src="/images/j5.png" alt="" style="max-width: 100%;"></a></p>
<p>注：注：如果是GB2312编码文档，需转成utf-8再上传；文档向量化支持pdf但文字提取效果一般；建议以txt、csv格式文件为主</p>
<h4><a id="user-content-删除知识库" class="anchor" aria-hidden="true" href="#删除知识库"><span aria-hidden="true" class="octicon octicon-link"></span></a>删除知识库</h4>
<p>下滑，点击删除知识库</p>
<p>适用于测试完导入数据之后，删除不用的测试知识库</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/Snipaste_2023-08-24_17-14-42.png"><img src="/images/Snipaste_2023-08-24_17-14-42.png" alt="" style="max-width: 100%;"></a></p>
<h2><a id="user-content-敏感词过滤" class="anchor" aria-hidden="true" href="#敏感词过滤"><span aria-hidden="true" class="octicon octicon-link"></span></a>敏感词过滤</h2>
<p>敏感词使用<code>redis</code>进行存储, <code>redis</code>相关操作命令在此不赘述</p>
<p>如需对redis进行快速增删改查，请使用<code>redis.ipynb</code> 这个jupyter notebook文件(推荐使用vscode的远程ssh插件连接到服务器再进行操作，有图形界面可以使用，非常方便)</p>
<p>全部敏感词文件位置: <code>/root/hw/敏感词过滤/敏感词词库</code></p>
<p>可以使用<code>sadd &lt;敏感词&gt;</code> 和 <code>sdel &lt;敏感词&gt;</code> 来增加和删除敏感词，该命令会通过网络接口直接更新部署接口的敏感词库</p>
<blockquote>
<p>要使用sadd和sdel命令，需要后台开启监听管道的python进程<code>api_sensitive_words.py</code>, 这个文件的位置在<code>/root/hw/敏感词过滤</code>, 使用根目录中的脚本，在命令行<code>conda activate hw</code>之后, <code>./deploy.sh</code>直接运行(需要自行在命令行中先<code>conda activate hw</code>, shell脚本中无法<code>conda activate hw</code>)</p>
</blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-42-11.png"><img src="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-42-11.png" alt="" style="max-width: 100%;"></a></p>
<h2><a id="user-content-小工具" class="anchor" aria-hidden="true" href="#小工具"><span aria-hidden="true" class="octicon octicon-link"></span></a>小工具</h2>
<blockquote>
<p>.ipynb为jupyter notebook, 使用vscode的远程ssh插件可以非常方便地运行</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">api</td>
<td align="left">查看所有正在运行的接口程序(<em>这些程序中都有api三个字, 相当于简化版的 <code>ps aux | grep api</code></em>)</td>
</tr>
<tr>
<td align="left">gpu</td>
<td align="left">查看显卡显存占用情况</td>
</tr>
<tr>
<td align="left">tsh &lt;文件/文件夹&gt;</td>
<td align="left">将文件移动到废纸篓(位置<code>/root/.Trash</code>)</td>
</tr>
<tr>
<td align="left">dtest &lt;问题&gt;</td>
<td align="left">使用&lt;问题&gt;进行知识库问答(即用于测试知识库模型表现)</td>
</tr>
<tr>
<td align="left">redis.ipynb</td>
<td align="left">敏感词库快速操作(运行环境: hw)</td>
</tr>
<tr>
<td align="left">sadd &lt;敏感词&gt;</td>
<td align="left">增加敏感词并更新敏感词库</td>
</tr>
<tr>
<td align="left">sdel &lt;敏感词&gt;</td>
<td align="left">删除敏感词并更新敏感词库</td>
</tr>
</tbody>
</table>
<h2><a id="user-content-常见bug" class="anchor" aria-hidden="true" href="#常见bug"><span aria-hidden="true" class="octicon octicon-link"></span></a>常见BUG</h2>
<h4><a id="user-content-1-选择知识库报错" class="anchor" aria-hidden="true" href="#1-选择知识库报错"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. 选择知识库报错</h4>
<p><a target="_blank" rel="noopener noreferrer" href="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-05-51.png"><img src="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-05-51.png" alt="" style="max-width: 100%;"></a></p>
<p>解决办法:</p>
<p><code>File not found error</code>代表知识库已不存在，可能是知识库已被删除，新建一个知识库并导入数据即可(已有的稳定数据在<code>/root/hw/Langchain-Chatchat/婚恋知识库备份</code>中有保存)</p>
<p><a target="_blank" rel="noopener noreferrer" href="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-09-17.png"><img src="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-09-17.png" alt="" style="max-width: 100%;"></a></p>
<h4><a id="user-content-2-使用知识库对话时检索出错" class="anchor" aria-hidden="true" href="#2-使用知识库对话时检索出错"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. 使用知识库对话时检索出错</h4>
<p><a target="_blank" rel="noopener noreferrer" href="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-14-32.png"><img src="/images/docs/%E4%B9%90%E5%94%AF/Snipaste_2023-08-23_15-14-32.png" alt="" style="max-width: 100%;"></a></p>
<p>解决办法:</p>
<p>可能是因为删除了向量索引，导致向量数据库出错。此时的最好办法是新建一个知识库，重新导入数据并重新创建向量索引。</p>
<h2><a id="user-content-代码改动详解" class="anchor" aria-hidden="true" href="#代码改动详解"><span aria-hidden="true" class="octicon octicon-link"></span></a>代码改动详解</h2>
<p>对langchain-chatchat项目主要改动了如下文件的代码</p>
<ul>
<li>server/chat/knowledge_base_chat.py</li>
</ul>
<h4><a id="user-content-1-增加do_shuffle字段调用时不强制要求-匹配文本充足时随机选取其中的几个可以使得每次生成的回答有所区别" class="anchor" aria-hidden="true" href="#1-增加do_shuffle字段调用时不强制要求-匹配文本充足时随机选取其中的几个可以使得每次生成的回答有所区别"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. 增加do_shuffle字段(调用时不强制要求), 匹配文本充足时，随机选取其中的几个(可以使得每次生成的回答有所区别)</h4>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># 105行</span>
<span class="pl-k">def</span> <span class="pl-en">knowledge_base_chat</span>(<span class="pl-s1">query</span>: <span class="pl-s1">str</span> <span class="pl-c1">=</span> <span class="pl-v">Body</span>(..., <span class="pl-s1">description</span><span class="pl-c1">=</span><span class="pl-s">"用户输入"</span>, <span class="pl-s1">examples</span><span class="pl-c1">=</span>[<span class="pl-s">"你好"</span>]),
                        <span class="pl-s1">knowledge_base_name</span>: <span class="pl-s1">str</span> <span class="pl-c1">=</span> <span class="pl-v">Body</span>(..., <span class="pl-s1">description</span><span class="pl-c1">=</span><span class="pl-s">"知识库名称"</span>, <span class="pl-s1">examples</span><span class="pl-c1">=</span>[<span class="pl-s">"samples"</span>]),
                        <span class="pl-s1">top_k</span>: <span class="pl-s1">int</span> <span class="pl-c1">=</span> <span class="pl-v">Body</span>(<span class="pl-v">VECTOR_SEARCH_TOP_K</span>, <span class="pl-s1">description</span><span class="pl-c1">=</span><span class="pl-s">"匹配向量数"</span>),
                        <span class="pl-s1">history</span>: <span class="pl-v">List</span>[<span class="pl-v">History</span>] <span class="pl-c1">=</span> <span class="pl-v">Body</span>([],
                                                      <span class="pl-s1">description</span><span class="pl-c1">=</span><span class="pl-s">"历史对话"</span>,
                                                      <span class="pl-s1">examples</span><span class="pl-c1">=</span>[[
                                                          {<span class="pl-s">"role"</span>: <span class="pl-s">"user"</span>,
                                                           <span class="pl-s">"content"</span>: <span class="pl-s">"我们来玩成语接龙，我先来，生龙活虎"</span>},
                                                          {<span class="pl-s">"role"</span>: <span class="pl-s">"assistant"</span>,
                                                           <span class="pl-s">"content"</span>: <span class="pl-s">"虎头虎脑"</span>}]]
                                                      ),
                        <span class="pl-s1">stream</span>: <span class="pl-s1">bool</span> <span class="pl-c1">=</span> <span class="pl-v">Body</span>(<span class="pl-c1">False</span>, <span class="pl-s1">description</span><span class="pl-c1">=</span><span class="pl-s">"流式输出"</span>),
                        <span class="pl-s1">local_doc_url</span>: <span class="pl-s1">bool</span> <span class="pl-c1">=</span> <span class="pl-v">Body</span>(<span class="pl-c1">False</span>, <span class="pl-s1">description</span><span class="pl-c1">=</span><span class="pl-s">"知识文件返回本地路径(true)或URL(false)"</span>),
                        <span class="pl-s1">do_shuffle</span>: <span class="pl-s1">bool</span> <span class="pl-c1">=</span> <span class="pl-v">Body</span>(<span class="pl-c1">False</span>, <span class="pl-s1">description</span><span class="pl-c1">=</span><span class="pl-s">"随机丢弃匹配到的知识"</span>),
                        <span class="pl-s1">request</span>: <span class="pl-v">Request</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>,
                        ):</pre></div>
<h4><a id="user-content-2-do_shuffle的实现以及检查检索到的文本是否多于content_length_threshold阈值" class="anchor" aria-hidden="true" href="#2-do_shuffle的实现以及检查检索到的文本是否多于content_length_threshold阈值"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. do_shuffle的实现，以及检查检索到的文本是否多于content_length_threshold阈值.</h4>
<p>若检索到的文本的长度大于这个阈值，说明匹配到了充足的文本，认为真正检索到了文本。若小于它，认为没有检索到文本。
若没有检索到文本，返回300(这里的300是字符串，且作为纯文本返回，是为了配合后续代码中的return StreamingResponse(knowledge_base_chat_iterator(query, kb, top_k, history, docs), media_type="text/event-stream") 而被使用，是非常丑陋的实现，后续可以改进)</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># 128行</span>
<span class="pl-s1">docs</span> <span class="pl-c1">=</span> <span class="pl-s1">kb</span>.<span class="pl-en">search_docs</span>(<span class="pl-s1">query</span>, <span class="pl-s1">top_k</span>)
<span class="pl-k">if</span> <span class="pl-s1">do_shuffle</span>:
	<span class="pl-en">shuffle</span>(<span class="pl-s1">docs</span>)
	<span class="pl-s1">docs</span> <span class="pl-c1">=</span> <span class="pl-s1">docs</span>[<span class="pl-c1">-</span><span class="pl-c1">4</span>:]

<span class="pl-s1">content_length_threshold</span> <span class="pl-c1">=</span> <span class="pl-c1">420</span>
<span class="pl-s1">tmp_l</span> <span class="pl-c1">=</span> [<span class="pl-c1">0</span>]
<span class="pl-s1">tmp_l</span>.<span class="pl-en">extend</span>(<span class="pl-s1">docs</span>)
<span class="pl-s1">is_content_valid</span> <span class="pl-c1">=</span> <span class="pl-k">lambda</span> <span class="pl-s1">docs</span>: <span class="pl-en">reduce</span>(<span class="pl-k">lambda</span> <span class="pl-s1">x</span>, <span class="pl-s1">y</span>: <span class="pl-s1">x</span> <span class="pl-c1">+</span> <span class="pl-en">len</span>(<span class="pl-s1">y</span>.<span class="pl-s1">page_content</span>), <span class="pl-s1">docs</span>) <span class="pl-c1">&gt;=</span> <span class="pl-s1">content_length_threshold</span>
<span class="pl-c"># print(f"docs length(characters): {reduce(lambda x, y: x + len(y.page_content), tmp_l)}")</span>
<span class="pl-k">if</span> <span class="pl-en">len</span>(<span class="pl-s1">docs</span>) <span class="pl-c1">==</span> <span class="pl-c1">0</span> <span class="pl-c1">or</span> \
   <span class="pl-c1">not</span> <span class="pl-en">is_content_valid</span>(<span class="pl-s1">tmp_l</span>):
	<span class="pl-k">return</span> <span class="pl-s">"300"</span></pre></div>
<h4><a id="user-content-3-改动configsmodel_configpy中的参数" class="anchor" aria-hidden="true" href="#3-改动configsmodel_configpy中的参数"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. 改动<code>configs/model_config.py</code>中的参数</h4>
<p>改动知识库匹配相关度阈值</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># 知识库匹配相关度阈值，取值范围在0-1之间，SCORE越小，相关度越高，取到1相当于不筛选，建议设置在0.5左右</span>
<span class="pl-v">SCORE_THRESHOLD</span> <span class="pl-c1">=</span> <span class="pl-c1">0.49</span></pre></div>
<p>改动chatglm2-6b模型路径</p>
<div class="highlight highlight-source-python"><pre><span class="pl-s">"chatglm2-6b"</span>: {
	<span class="pl-s">"local_model_path"</span>: <span class="pl-s">"/root/haoyu/ChatGLM2-6B/chatglm2-6b"</span>,
	<span class="pl-s">"api_base_url"</span>: <span class="pl-s">"http://localhost:8888/v1"</span>,  <span class="pl-c"># "name"修改为fastchat服务中的"api_base_url"</span>
	<span class="pl-s">"api_key"</span>: <span class="pl-s">"EMPTY"</span>
}</pre></div>

</article>
<div>
</div>
</div>
</html>